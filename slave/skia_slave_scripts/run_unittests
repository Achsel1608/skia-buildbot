#!/usr/bin/env python
# Copyright (c) 2012 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

"""Runs all unit tests under this base directory."""

import os
import sys
import unittest


if __name__ == '__main__':
  test_runner = unittest.TextTestRunner()
  super_suite = unittest.TestSuite()

  for (dirpath, unused_dirnames, filenames) in os.walk(os.getcwd()):

    if not dirpath or not filenames or '.svn' in dirpath:
      continue

    # Find all unit test modules.
    test_modules = [filename.split('.')[0] for filename in filenames
                    if filename.endswith('_test.py')]

    if not test_modules:
      continue

    # The relative path of this directory compared to the current working
    # directory.
    cwd = os.getcwd().split(os.path.sep)
    test_dir = dirpath.split(os.path.sep)
    relative_path = test_dir[len(cwd):]

    for test_module in test_modules:
      import_path = '%s.%s' % ('.'.join(relative_path), test_module)
      suite = unittest.defaultTestLoader.loadTestsFromName(import_path)
      print 'Added suite %s to the super_suite.' % suite
      super_suite.addTests(suite)

  print '\n\nExecuting all suites:\n'
  test_runner.run(super_suite)
