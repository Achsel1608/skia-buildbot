<!-- The <single-detail-sk> custom element declaration.

This element displays all the know details about
a given digest.

  Attributes:
    test - The name of the test.
    digest - The digest.
  Events:
  Methods:
-->
<polymer-element name="single-detail-sk" attributes="test digest">
  <template>
    <style type="text/css" media="screen">
      th {
        text-align: right;
      }

      th, td {
        text-align: left;
        padding: 5px;
        vertical-align: top;
      }

      tri-sk {
        min-width: 15em;
        display: block;
      }

      #paramHeader {
        padding-top: 2em;
        text-decoration: underline;
      }

      .openInNew {
        position: relative;
      }

      .openInNew a {
        top: 5px;
        position: absolute;
      }
    </style>
    <table>
      <tr>
        <th>Status</th>
        <td><tri-sk id=topDetail value="{{details.topStatus}}"></tri-sk></td>
      </tr>
      <tr>
        <th>Image</th>
        <td class=openInNew><img src="/img/images/{{digest}}-thumbnail.png">
          <a href="/img/images/{{digest}}.png" target=_blank><core-icon icon="open-in-new"></core-icon></a>
        </td>
        </td>
      </tr>
      <tr>
        <th>Test</th>
        <td><a href="/2/cmp/{{test}}">{{test}}</a></td>
      </tr>
      <tr>
        <th>Digest</th>
        <td>{{digest}}</td>
      </tr>
      <tr><th colspan=2 id=paramHeader>Parameters</th></tr>
      <template repeat="{{p in details.params}}">
        <tr>
          <th>{{p.name}}</th>
          <td class=pval>
            <template repeat="{{n in p.top}}">
              {{n}}
            </template>
          </td>
        </tr>
      </template>
    </table>
  </template>
  <script>
    Polymer({
      ready: function() {
        this.test = "";
        this.digest = "";
        this.details = {};

        var that = this;
        this.$.topDetail.addEventListener('change', function(e) {
          e.stopPropagation();
          var detail = {
            test: that.test,
            digest: that.digest,
            status: e.detail,
          };
          that.dispatchEvent(new CustomEvent('triage', {detail: detail}));
        });

      },

      changeImpl_: function() {
        if (this.test == "" || this.digest == "") {
          return
        }
        var that = this;
        var q = '?test=' + this.test + '&top=' + this.digest + '&left=' + this.digest;
        sk.get('/2/_/details'+q).then(JSON.parse).then(function(json) {
          that.details = json;
        });
      },

      testChanged: function() {
        this.changeImpl_();
      },

      digestChanged: function() {
        this.changeImpl_();
      },

    });
  </script>
</polymer-element>
