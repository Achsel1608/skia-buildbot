<!DOCTYPE html>
<html>
  <head>
    <title>Skia Correctness Server</title>

    {{template "header.html" .}}

    <!-- TODO(jcgregorio) Move this into res/css/main.css. -->
    <style type="text/css" media="screen">
      body {
        font-family: Arial, sans-serif;
        font-size: 15px;
      }

      #refresh.display {
        display: block;
      }

      #refresh {
        display: none;
      }

      #pageWrapper {
        background: white;
      }
      .col {
        padding: 0.5em;
      }

      html /deep/ core-toolbar,
      #title {
        background-color: #D95F02;
        color: #fff;
      }

      #title login-sk {
        margin-left: auto;
      }

      #title /deep/ a {
        color: white;
      }

      html /deep/ a {
        color: #FF7F00;
        font-weight: bold;
      }

      html /deep/ #mainContainer {
        padding: 1em;
        background: white;
      }

      html /deep/ paper-button {
        color: #1F78B4;
      }

      html /deep/  paper-button:hover {
        background: #eee;
      }

      query-sk {
        display: block;
      }

      html /deep/ #leftControl {
        margin-top: 64px;
      }

      paper-button.square {
        min-width: 2em;
        margin: 5px;
      }

      #leftControl {
        margin-right: 1em;
      }

      #topControl {
        margin-bottom: 1em;
        display: block;
      }

    </style>
  </head>
  <body>
    <scaffold-sk responsiveWidth="700px">
      {{template "titlebar.html" .}}

      <div id=page horizontal layout>
        <div id=leftControl vertical layout>
          <tri-sk vert filter value=positive></tri-sk>
          <paper-button title="Filter" class=square><core-icon icon=search></core-icon> </paper-button>
          <paper-button title="Sort by the number of times a digest appears." class=square><core-icon icon=sort></core-icon>N </paper-button>
        </div>

        <div flex verical layout>
          <div flex horizontal layout>
            <tri-sk id=topControl filter value=untriaged></tri-sk>
            <paper-button title="Filter" class=square><core-icon icon=search></core-icon> </paper-button>
            <paper-button title="Sort by number of pixels that are different from the first image on the right hand side."  class=square><core-icon icon=sort></core-icon>&Delta; </paper-button>
          </div>
          <grid-sk></grid-sk>
          <paper-button id=refresh>Refresh</paper-button>
        </div>

        <diff-detail-sk flex></diff-detail-sk>

      </div>
      <paper-toast></paper-toast>

    </scaffold-sk>

    <script type="text/javascript" charset="utf-8">
     (function() {
       // Strip off the /testname from the URL.
       var re = new RegExp("/2/cmp/(.*)", "");
       var s = window.location.pathname;
       var match = s.match(re);
       var testName = "";
       if (match.length == 2) {
          testName = match[1];
       }

       function loadGrid() {
         if (testName != '') {
           sk.post('/2/_/test', JSON.stringify({"test": testName})).then(JSON.parse).then(function(json) {
             $$$('grid-sk').setValue(json);
           }).catch(function(e) {
             $$$('paper-toast').text = e;
             $$$('paper-toast').show();
           });
         } else {
           $$$('paper-toast').text = "Not a valid test name.";
           $$$('paper-toast').show();
         }
         $$$('#refresh').classList.remove('display');
       }

       loadGrid();

       $$$('grid-sk').addEventListener('diff-click', function(e) {
         $$$('diff-detail-sk').highlight = e.detail;
         var value = {
           top:  e.detail.topDigest,
           left: e.detail.leftDigest,
           test: testName
         };
         $$$('diff-detail-sk').value = value;
       });

       $$$('diff-detail-sk').addEventListener('triage', function(e) {
         sk.post('/2/_/triage', JSON.stringify(e.detail)).then(function(){
           $$$('grid-sk').markChanged(e.detail.digest);
           $$$('#refresh').classList.add('display');
         }).catch(function(e) {
           $$$('paper-toast').text = e;
           $$$('paper-toast').show();
         });
       });

       $$$('#refresh').addEventListener('click', function(e) {
         loadGrid();
       });
     })();
    </script>
  </body>
</html>
