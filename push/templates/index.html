<!DOCTYPE html>
<html>
  <head>
    <title>Skia Push Server</title>

    {{template "header.html" .}}

    <style is="custom-style" type="text/css" media="screen">
      :root {
        --default-primary-color: #1f78b4;
      }
    </style>

    <style type="text/css" media="screen">
      body {
        font-family: Arial, sans-serif;
        font-size: 15px;
      }

      login-sk {
        margin-left: auto;
      }

      login-sk a {
        color: white;
      }

      a {
        color: #1f78b4;
        font-weight: bold;
      }

      #mainContainer {
        background: white;
        padding: 2em 1em;
      }

      paper-toast {
        margin: 2em;
      }

      html, body {
        height: 100%;
        margin: 0;
      }

      paper-header-panel {
        height: 100%;
      }

    </style>
  </head>
  <body class="fullbleed layout vertical">
    <paper-header-panel mode=scroll>
      {{template "titlebar.html" .}}

      <push-server-sk></push-server-sk>
      <paper-toast></paper-toast>
    </paper-header-panel>

    <script type="text/javascript" charset="utf-8">
      sk.get("/_/state").then(JSON.parse).then(function(json) {
        $$$('push-server-sk').setConfig(json.servers, json.packages, json.ip);
        Object.keys(json.status).forEach(function(service) {
          sk.Mailbox.send(service, json.status[service]);
        });
      });

      $$$('push-server-sk').addEventListener('change-package', function(e) {
        var body = {
          Name: e.detail.name,
          Server: e.detail.server
        };
        sk.post("/_/state", JSON.stringify(body)).then(JSON.parse).then(function(json) {
          $$$('push-server-sk').setConfig(json.servers, json.packages, json.ip);
        }).catch(function(e){
          $$$('paper-toast').text = e;
          $$$('paper-toast').show();
        });
      });

      $$$('push-server-sk').addEventListener('unit-action', function(e) {
        sk.post("/_/change?" + sk.query.fromObject(e.detail), "").then(JSON.parse).then(function(json) {
          $$$('paper-toast').text = json.result;
          $$$('paper-toast').show();
        }).catch(function(e) {
          $$$('paper-toast').text = e;
          $$$('paper-toast').show();
        });
      });
    </script>
  </body>
</html>
