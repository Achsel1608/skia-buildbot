<html>
  <head>
    <title>
      Skia Buildbot
    </title>
    <link rel="icon" href="favicon.ico">

    <script language="JavaScript">
    var nonbench_percommit_builders = [];
    var bench_percommit_builders = [];
    var all_percommit_builders = [];
    var try_builders = [];

    var display_builders = "nonbench";
    var display_builders_list = nonbench_percommit_builders;
    var display_view = "external";
    var display_page = "console";
    var internalport = "10115";
    var externalport = "10117";
    var port = externalport;
    var host = "http://70.32.156.51";

    // Return a string of the form: "&builder=x&builder=y..." with all of those
    // contained in the given array of builders.
    function getBuilderString(builders) {
      var builder_string = "";
      for (i = 0; i < builders.length; i++) {
        builder_string = builder_string.concat("&builder=", builders[i]);
      }
      return builder_string;
    }

    // Reload the buildbot console page in the iframe with whatever options we
    // have set.
    function updateView() {
      port = externalport;
      document.all.external.checked = true;
      if (display_view == "internal") {
        port = internalport;
        document.all.internal.checked = true;
      }
      var url = host + ":" + port + "/" + display_page +
                "?reload=40" + getBuilderString(display_builders_list);
      document.all.content.src = url
      var id = display_builders + "_" + display_page;
      document.getElementById(id).checked = true;
    }

    // Parse the variables in the URL and return a key/value dictionary.
    function parseArgs()
    {
      var args = [];
      var dict = window.location.search.slice(1).split('&');
      for(var i = 0; i < dict.length; i++) {
        var split = dict[i].split('=');
        args.push(split[0]);
        args[split[0]] = split[1];
      }
      
      return args;
    }

    // Reload this page, setting the given variables in the URL.
    function reloadWithOptions(view, builders, page) {
      location.href = "?view=" + view + "&builders=" + builders + "&page=" +
          page;
    }

    // Obtain the list of all builders from the buildbot master and load them
    // into the global arrays of builders.
    function getBuilderLists() {
      try {
        var request = new XMLHttpRequest();
      } catch (error) {
        alert(error);
      }
      request.open("GET", host + ":" + port + "/json/builders", false);
      request.send(null);
      // We *should* use a JSON parser, but since we trust the buildbot master
      // server, we allow this unsafe call 
      var builders_json = eval("(" + request.responseText + ")");
      nonbench_percommit_builders = [];
      bench_percommit_builders = [];
      all_percommit_builders = [];
      try_builders = [];
      for (var builder in builders_json) {
        if (builder.indexOf("Trybot") != -1) {
          try_builders.push(builder)
        } else {
          all_percommit_builders.push(builder);
          if (builder.indexOf("Bench") != -1) {
            bench_percommit_builders.push(builder);
          } else {
            nonbench_percommit_builders.push(builder);
          }
        }
      }
    }

    // Function to call on page load.  Sets all global variables and updates the
    // iframe view of the buildbot page.
    function init() {
      getBuilderLists();
      args = parseArgs();
      display_builders = args["builders"];
      if (!display_builders) {
        display_builders = "nonbench";
      }
      if (display_builders == "bench") {
        display_builders_list = bench_percommit_builders;
      } else if (display_builders == "all") {
        display_builders_list = all_percommit_builders;
      } else if (display_builders == "try") {
        display_builders_list = try_builders;
      } else {
        display_builders = "nonbench";
        display_builders_list = nonbench_percommit_builders;
      }
      display_view = args["view"];
      if (!display_view)
        display_view = "external";
      display_page = args["page"];
      if (!display_page)
        display_page = "console";
      updateView();
    }

    function reloadSkiaTreeStatus() {
      document.getElementById("skia-tree-status").src = document.getElementById("skia-tree-status").src;
    }

    window.setInterval("reloadSkiaTreeStatus();", 10000);
    </script>

  </head>
  <body onload="init()" style="background-color: #fff;">

    <iframe id="skia-tree-status" width="100%" height="60" frameborder="0" scrolling="no" src="http://skia-tree-status.appspot.com/banner-status"></iframe>

    <div id="heading" style="font-size:2.5em; text-align:center;">Skia Buildbots</div>

    <div style="position:absolute; left:10; top:75;">
    <form name="unused">
      <input type="radio" name="internal_external" value="external" id="external" onClick="reloadWithOptions('external', display_builders, display_page);">external view<br>
      <input type="radio" name="internal_external" value="internal" id="internal" onClick="reloadWithOptions('internal', display_builders, display_page);">internal view
    </form>
    </div>

    <div style="position:absolute; right:10; top:48;">
    <a href="https://sites.google.com/site/skiadocs/developer-documentation/the-skia-buildbots/1-overview" target="_blank">Full Skia documentation</a><br/>
    <a href="https://skia-tree-status.appspot.com/" target="_blank">Skia Tree Status Manager</a><br/>
    <a href="https://code.google.com/p/skia/issues/list?can=2&q=label%3ABreakingTheBuildbots" target="_blank">Current build-breaking bugs</a><br/>
    <a href="bench_graphs.html" target="_blank">Bench Graphs</a><br/>
    <a href="http://go/skpbench" target="_blank">Bench Dashboard</a>
    </div>
    <div style="text-align:center;">
      <form name="unused2">
        <input type="radio" id="nonbench_console" value="nonbench_console" onClick="javascript:reloadWithOptions(display_view, 'nonbench', 'console');">Non-Bench Builders
        <input type="radio" id="bench_console" value="bench_console" onClick="javascript:reloadWithOptions(display_view, 'bench', 'console');">Bench Builders
        <input type="radio" id="all_console" value="all_console" onClick="javascript:reloadWithOptions(display_view, 'all', 'console');">All Builders
        <input type="radio" id="try_waterfall" value="try_waterfall" onClick="javascript:reloadWithOptions(display_view, 'try', 'waterfall');">Trybots
      </form>
    </div>
   <!-- Waterfall: 
    <a href="javascript:reloadWithOptions(display_view, 'nonbench', 'waterfall');">Non-Bench Builders</a>
    |
    <a href="javascript:reloadWithOptions(display_view, 'bench', 'waterfall');">Bench Builders</a>
    |
    <a href="javascript:reloadWithOptions(display_view, 'all', 'waterfall');">All Builders</a>-->

    <iframe id="content" width="100%" height="4650px" src="about:blank" frameborder="0""></iframe>

  </body>
</html>
