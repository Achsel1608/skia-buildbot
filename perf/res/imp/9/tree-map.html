<!-- The <tree-map-sk> custom element declaration.

  Displays data in a treemap format.

  Attributes:
    None.

  Events:
    None.

  Methods:
    setData(data) - Passes in the data for the tree map. The data should be
      formatted as a series of nested objects, each with a 'name' attribute and
      an optional 'children' attribute, which is an Array of such objects. Leaf
      nodes should contain a 'count' attribute with an Number value. For example:

      {
        "name" : "treemap",
        "children" : [
          {
            "name" : "GL_VERSION",
            "children" : [
              { "count" : 3, "name" : "4.1 INTEL-10.10.18" },
              { "count" : 1, "name" : "OpenGL ES 2.0 (ANGLE 2.1.0.8182049470aa)" }
            ]
          },
          {
            "name" : "bench_type",
            "children" : [
              { "name" : "micro", "count" : 4 }
            ]
          },
          ...

    clear() - Removes all child elements, erasing the treemap.

-->

<script src="/res/imp/bower_components/d3/d3.js"></script>

<!-- Styles for nodes created by D3 need to be set outside the element definition because Shady DOM. -->
<style>
  .tree-map-sk-node {
    border: solid 1px white;
    font: 11px sans-serif;
    line-height: 12px;
    overflow: hidden;
    position: absolute;
    text-indent: 2px;
    color: white;
    text-shadow: 2px 2px 3px black;
  }
</style>

<dom-module id="tree-map-sk">
  <style>
    :host {
      position: relative;
      width: 640px;
      height: 480px;
      display: block;
    }
  </style>
  <template>
  </template>
</dom-module>

<script>
  Polymer({
    is: "tree-map-sk",

    ready: function() {
      this._color = d3.scale.category10();

      this._treemap = d3.layout.treemap()
        .size([640, 480])
        .sticky(true)
        .value(function(d) { return d.count; });
    },

    setData: function(data) {
      this.clear();
      d3.select(this).datum(data).selectAll(".tree-map-sk-node")
        .data(this._treemap.nodes)
      .enter().append("div")
        .attr("class", "tree-map-sk-node")
        .call(this._position)
        .style("background", function(d) { return d.children ?  this._color(d.name) : null; }.bind(this))
        .attr("title", function(d) { return d.children ? null : d.name; })
        .text(function(d) { return d.children ? null : d.name; });
    },

    clear: function() {
      sk.clearChildren(this);
    },

    _position: function() {
      this.style("left", function(d) { return d.x + "px"; })
        .style("top", function(d) { return d.y + "px"; })
        .style("width", function(d) { return Math.max(0, d.dx - 1) + "px"; })
        .style("height", function(d) { return Math.max(0, d.dy - 1) + "px"; });
    },

  });
</script>
