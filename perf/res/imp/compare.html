<!--
  The common.js file must be included before this file.

  This in an HTML Import-able file that contains the CSS, JS and HTML
  Templates for the sk.Compare components.

  To use this file import it:

    <link href="/res/imp/compare.html" rel="import" />

-->
<template id=compTableTemplate>
  <table class=compTable></table>
</template>

<template id=compTrTemplate>
  <tr class=compTr data-weight="0"></tr>
</template>

<template id=compThTemplate>
  <th class=compTh></th>
</template>

<template id=compTdTemplate>
  <td class=compTd></td>
</template>

<style type="text/css" media="screen">
  .compTable,
  .compTh,
  .compTd {
    border: 1px solid black;
  }
</style>

<script type="text/javascript" charset="utf-8">
(function(){
  "use strict";

  // Keep track of this file so we can grab HTML Templates from it.
  var importer__ = new sk.Importer();

  /**
    * Compare is a container for the compare results.
    */
  sk.Compare = function() {
  };

  /**
    * attach, call after construction to hook up elements to their callbacks.
    */
  sk.Compare.prototype.attach = function(e) {
    // resultsContainer_ is the DOM node containing compare results.
    this.resultsContainer_ = $$$('#skCompare');
  };

  /**
    * compareResults_ tries to construct a table from data and return it. If
    * it finds there is no data to put in the table, will return the error
    * information in text.
    *
    * Parameters cols, cells are defined differently in different contexts.
    * Please refer to the calling function for details. In general,
    *
    * cols contains the column names for the resulting table.
    *
    * cells is an object keyed by table row name. Within each row, keys are the
    * corresponding column indices in the cols above, and values are the pair of
    * bench values corresponding to the pair of data to compare. Example:
    * {
    *   "Deque_Push_640_480": {
    *     "0": [0.9, 1.3],
    *     "2": [1.1, 0.8],
    *     ...
    *   },
    *   "Another_Test": {
    *     "1": [0, 0.7],
    *     ...
    *   },
    *   ...
    * }
    *
    */
  sk.Compare.prototype.display = function(cols, cells) {
    sk.clearChildren(this.resultsContainer_);
    var node = importer__.import('#compTableTemplate');
    this.resultsContainer_.appendChild(node);
    var header = $$$('.compTr', importer__.import('#compTrTemplate'));
    var testTh = $$$('.compTh', importer__.import('#compThTemplate'));
    testTh.innerText = 'test';
    header.appendChild(testTh);
    cols.forEach(function(c) {
      var th = $$$('.compTh', importer__.import('#compThTemplate'));
      th.innerText = c;
      header.appendChild(th);
    });
    var tableRows = Object.keys(cells).map(function(row) {
      var tr = $$$('.compTr', importer__.import('#compTrTemplate'));
      var testTd = $$$('.compTd', importer__.import('#compTdTemplate'));
      testTd.innerText = row;
      tr.appendChild(testTd);
      var rowData = cells[row];
      var weight = 0.0;
      for (var i = 0; i < cols.length; i++) {
        var val = 0;  // Ratio of two benches for the criterion; default to 0.
        if (+i in rowData) {
          if (rowData[+i][0] > 0 && rowData[+i][1] > 0) {
            val = rowData[+i][1] / rowData[+i][0];
            weight += val;
          }
        }
        var td = $$$('.compTd', importer__.import('#compTdTemplate'));
        td.innerText = '' + val.toFixed(3);
        tr.appendChild(td);
      }
      tr.dataset.weight = weight;
      return tr;
    });
    // Sort rows by weight, descending.
    tableRows.sort(function(a, b) {
      return b.dataset.weight - a.dataset.weight
    });
    var table = $$$('.compTable', this.resultsContainer_);
    table.appendChild(header);
    tableRows.forEach(function(r) {
      table.appendChild(r);
    });
  }

})();
</script>
