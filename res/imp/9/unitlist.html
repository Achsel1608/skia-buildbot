<!-- The <unit-list-sk> custom element declaration.

  Attributes:
    machine - The DNS name of the machine.

  Events:
    unit-action - Event generated when start, stop, or restart are clicked.
        Emits an event of the form:

        {
          machine: "skia-monitoring",
          name: "logserver.service",
          action: "restart"
        }

  Methods:
-->

<dom-module id="unit-list-sk">
  <style>
    paper-button:hover {
      background: #eee;
    }

    td,
    th {
      padding: 0.2em 0.4em;
    }
  </style>
  <template>
    <table id=list>
      <tr><th>Service</th><th>Status</th><th>Uptime</th></tr>
      <template is="dom-repeat" items="{{units}}">
        <tr>
          <td>[[item.status.Name]]</td><td><unit-status-sk status="[[item.status.SubState]]"></unit-status-sk></td>
          <td>[[uptimeOf(item.props.ExecMainStartTimestamp)]]</td>
          <td><paper-button raised data-action="start" data-name$="[[item.status.Name]]">Start  </paper-button></td>
          <td><paper-button raised data-action="stop" data-name$="[[item.status.Name]]">Stop   </paper-button></td>
          <td><paper-button raised data-action="restart" data-name$="[[item.status.Name]]">Restart</paper-button></td>
        </tr>
      </template>
    </table>
  </template>
</dom-module>

<script>
  Polymer({
    is: "unit-list-sk",

    properties: {
      units: {
        type: Array,
        value: [],
      },
      machine: {
        type: String,
        value: "",
      },
      header: {
        type: Boolean,
        value: false,
      }
    },

    ready: function() {
      this.foo = "bar";
      var that=this;
      this.$.list.addEventListener('click', function(e) {
        // Find the paper-button element, it has the name and action
        // to perform in its data-attributes.
        var ele = e.target;
        while (ele != null) {
          if (ele.nodeName == "PAPER-BUTTON") {
            break;
          }
          ele = ele.parentElement;
        }
        if (ele) {
          var detail = {
            machine: this.machine,
            name: ele.dataset.name,
            action: ele.dataset.action,
          };
          that.dispatchEvent(new CustomEvent('unit-action', {detail: detail}));
        }
      });
    },

    uptimeOf: function(microSeconds) {
      return sk.human.diffDate(microSeconds/1000);
    },

  });
</script>
