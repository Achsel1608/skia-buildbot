<!--
  The res/js/fuzzer.js file must be included before this file.

  This in an HTML Import-able file that contains the definition
  of the following elements:

    <fuzzer-info-sk>

  This element will query /json/details for all of the detailed fuzz reports of a given file (passed in by query params) and displayed.
  This may be further scoped by function, line number and fuzz-type (either binary or api)

  To use this file import it:

    <link href="/res/imp/fuzzer-info-sk.html" rel="import" />

  Usage:

    <fuzzer-info-sk></fuzzer-info-sk>

  Properties:
    category: String.
    exclude: Array of String, all fuzzes that have one or more of these strings as a flag will not
        be shown.  This array must be sorted lexographically.
    include: Array of String, all fuzzes must have one or more of these strings as a flag to be
        shown.  This array must be sorted lexographically.

  Methods:
    None.

  Events:
    None.
-->

<link rel="import" href="/res/imp/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/res/imp/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/res/imp/bower_components/paper-input/paper-input.html">
<link rel="import" href="/res/common/imp/9/url-params-sk.html">

<link rel="import" href="fuzzer-collapse-file-sk.html">
<link rel="import" href="fuzzer-filter-sk.html">

<dom-module id="fuzzer-info-sk">
  <template>
    <iron-ajax auto url="/json/details"
      handle-as="json"
      params="[[_urlParams]]"
      last-response="{{_fileDetails}}">
    </iron-ajax>

    <template is="dom-repeat" items="{{_fileDetails}}" as="file" sort="_byCount" observe="count">
      <fuzzer-collapse-file-sk file="{{file}}"
          category="[[category]]"
          include="[[include]]"
          exclude="[[exclude]]"
          expand="[[_shouldExpand()]]">
      </fuzzer-collapse-file-sk>
    </template>

  </template>

  <script>
    Polymer({
      is: 'fuzzer-info-sk',

      properties: {
        category: {
          type: String,
          value: "",
        },
        include: {
          type: Array,
          value: function() {
            return [];
          }
        },
        exclude: {
          type: Array,
          value: function() {
            return [];
          }
        },
        _fileDetails: {
          type: Array,
          value: function() {
            return [];
          },
        },
        _urlParams: {
          type: String,
          computed: "_getURLParams(category)",
        },
      },
      _getURLParams: function(category) {
        return {
          "category": category,
          "file": fuzzer.paramFromPath("file"),
          "func": fuzzer.paramFromPath("func"),
          "line": fuzzer.paramFromPath("line"),
          "name": fuzzer.paramFromPath("name"),
        };
      },
      _shouldExpand: function(){
        return fuzzer.paramFromPath("file").length > 0;
      },
      _byCount: function(a, b) {
        // Higher counts come first
        return b.count - a.count;
      }
    });
  </script>
</dom-module>